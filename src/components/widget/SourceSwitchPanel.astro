---
import { sourcesConfig } from "../../config";
---

{sourcesConfig.enable && (
  <div class="card-base p-4 mt-4 shadow-lg border border-[var(--primary)]/30 rounded-xl bg-[var(--card-bg)]">
    <div class="font-bold text-xl mb-3 dark:text-white transition flex items-center gap-2">
      <span class="text-[var(--primary)]">ğŸ”„</span>
      <span>åˆ‡æ¢æº</span>
    </div>
    <div class="flex flex-col gap-2" id="source-switch-panel">
      {Object.entries(sourcesConfig.sources).map(([key, source]) => {
        // è·å–å½“å‰è·¯å¾„å’ŒæŸ¥è¯¢å‚æ•°
        const currentPath = Astro.url.pathname;
        const currentSearch = Astro.url.search;
        
        // æ„å»ºæ–°çš„ URL
        const newUrl = new URL(currentPath + currentSearch, source.url);
        
        return (
          <a
            href={newUrl.toString()}
            target="_self"
            class={`block px-4 py-3 rounded-lg transition-all duration-300 hover:bg-[var(--primary)]/20 hover:text-[var(--primary)] hover:translate-x-1 hover:shadow-md text-neutral-700 dark:text-neutral-300 ${key === sourcesConfig.defaultSource ? 'bg-[var(--primary)]/10 text-[var(--primary)] font-medium' : ''}`}
            data-source-key={key}
            data-source-url={source.url}
          >
            <div class="flex items-center justify-between">
              <span class="font-medium">{source.name}</span>
              <span class="text-sm text-[var(--primary)]/60">â†—ï¸</span>
            </div>
          </a>
        );
      })}
    </div>
    
    <script is:inline>
      // è‡ªåŠ¨è¯†åˆ«å½“å‰ä½¿ç”¨çš„æº
      function highlightCurrentSource() {
        const currentOrigin = window.location.origin;
        const sources = document.querySelectorAll('[data-source-key]');
        let hasMatchedSource = false;
        
        sources.forEach(source => {
          const sourceUrl = source.dataset.sourceUrl;
          const sourceOrigin = new URL(sourceUrl).origin;
          
          if (currentOrigin === sourceOrigin) {
            // é«˜äº®å½“å‰æº
            source.classList.add('bg-[var(--primary)]/25', 'text-[var(--primary)]', 'font-bold', 'border-l-4', 'border-[var(--primary)]', 'shadow-md');
            source.classList.remove('text-neutral-700', 'dark:text-neutral-300', 'border-l-0');
            hasMatchedSource = true;
          } else {
            // ç§»é™¤æ‰€æœ‰æºçš„é«˜äº®
            source.classList.remove('bg-[var(--primary)]/25', 'text-[var(--primary)]', 'font-bold', 'border-l-4', 'border-[var(--primary)]', 'shadow-md');
            source.classList.add('text-neutral-700', 'dark:text-neutral-300');
          }
        });
        
        // å¦‚æœæ²¡æœ‰åŒ¹é…çš„æºï¼Œä¿æŒé»˜è®¤çŠ¶æ€
        if (!hasMatchedSource) {
          sources.forEach(source => {
            const key = source.dataset.sourceKey;
            if (key === '${sourcesConfig.defaultSource}') {
              source.classList.add('bg-[var(--primary)]/10', 'text-[var(--primary)]', 'font-medium');
            } else {
              source.classList.remove('bg-[var(--primary)]/10', 'text-[var(--primary)]', 'font-medium');
            }
          });
        }
      }
      
      // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', highlightCurrentSource);
      } else {
        highlightCurrentSource();
      }
      
      // ç›‘å¬é¡µé¢åˆ‡æ¢äº‹ä»¶
      window.addEventListener('popstate', highlightCurrentSource);
    </script>
  </div>
)